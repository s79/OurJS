<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Animation</title>
<script src="../dev.js"></script>
<link rel="stylesheet" href="../../coding_standards/reset.css">
<style>
body { margin: 10px; padding: 0; font: 12px Verdana; }
h1 { height: 30px; margin: 0; padding: 0; font: 24px/30px Verdana; }
button { font: 12px Verdana; }
#test1,
#test2,
#test3 { width: 500px; margin: 5px; padding: 30px; background: #f5f5f5; font: 12px Verdana; text-align: center; }
#msg { height: 15px; text-align: left; }
#ani,
#layer { position: absolute; left: 450px; top: 10px; width: 200px; height: 50px; background: #c0c0c0; font: 14px/50px Verdana; text-align: center; }
#ani { left: 1200px; top: -150px; height: 150px; z-index: 1; background: #c0c0c0; line-height: 75px; }
#ani p { margin: 0; }
#layer { z-index: 2; }
#canvas { position: relative; width: 300px; height: 300px; margin: 0 auto; background: black; }
#canvas div { position: absolute; width: 2px; height: 2px; background: white; overflow: hidden; }
#layer.highlight { box-shadow: 0 0 25px black; }
</style>
</head>
<body>
<h1>Animation</h1>
<!-- example_1 { -->
<style>
#ex_1 { width: 200px; height: 20px; margin: 2px 0; padding: 1px 2px; border: 1px solid gray; background: gold; font: 14px/20px Verdana; text-align: center; }
</style>
<div id="ex_1">TEST</div>
<script>
execute(function($) {
  var $div = $('#ex_1')
      .on(
      'click', function() {
        this.morph({
          width: '+=100',
          height: '50px',
          padding: 20,
          borderWidth: 10,
          fontSize: 35,
          lineHeight: 50,
          backgroundColor: 'tomato',
          color: 'white'
        }, {
          delay: 100,
          duration: 1000,
          timingFunction: 'bounceIn'
        });
      });
});
</script>
<!-- } example_1 -->

<!-- example_2 { -->
<style>
#menu li { width: 200px; height: 30px; margin: 2px; padding-left: 10px; border-left: 1px solid white; background: mediumorchid; font: 14px/30px Verdana; cursor: default; }
</style>
<ul id="menu">
  <li>菜单一</li>
  <li>菜单二</li>
  <li>菜单三</li>
  <li>菜单四</li>
  <li>菜单五</li>
</ul>
<script>
execute(function($) {
  var menus = $('#menu').getChildren();
  menus.forEach(function($menu) {
    var animation = new Animation()
        .addClip(
        new Fx.Morph($menu, {
          borderLeftWidth: 10,
          backgroundColor: 'green',
          color: 'white'
        }, 0, 200, 'ease'));
    $menu.on(
        'mouseenter', function(e) {
          animation.play();
        })
        .on('mouseleave', function(e) {
          animation.reverse();
        });
  });
});
</script>
<!-- } example_2 -->


<div id="test1">
  <p id="msg"></p>
  <button id="highlight">highlight</button>
  <button id="fade_in">fadeIn</button>
  <button id="fade_out">fadeOut</button>
</div>
<div id="test2">
  <div id="layer"></div>
  <button id="reverse2">reverse</button>
  <button id="pause2">pause</button>
  <button id="play2">play</button>
  <button id="stop2">stop</button>
</div>
<div id="test3">
  <div id="canvas"></div>
  <p>点击 = 清除，Ctrl + 点击 = 一起跑，Shift + 点击 = 分别跑。</p>
  <button style="background-color: white;">linear</button>
  <button style="background-color: silver;">bounceIn</button>
  <button style="background-color: gold;">bounceOut</button>
  <br>
  <button style="background-color: orangered;">ease</button>
  <button style="background-color: greenyellow;;">easeIn</button>
  <button style="background-color: cornflowerblue;">easeOut</button>
  <button style="background-color: springgreen;">easeInOut</button>
  <button style="background-color: orchid;">easeOutIn</button>
  <br>
  <button style="background-color: tomato;">cubicBezier(.6,0,.6,1.35)</button>
  <button style="background-color: yellowgreen;">cubicBezier(.4,-0.35,.4,1)</button>
  <button style="background-color: steelblue;">cubicBezier(.5,.29,.23,-0.58)</button>
  <button style="background-color: mediumseagreen;">cubicBezier(.25,1.25,.75,-0.25)</button>
</div>
<style>
#ani_count_1,
#ani_count_2 { float: left; font-size: 12px; background: black; color: white; }
</style>
<div id="ani">
  <p><span id="ani_count_1"></span> <span id="ani_info_1"></span></p>
  <p><span id="ani_count_2"></span> <span id="ani_info_2"></span></p>
</div>
<script>
execute(function($) {
  var $ani = $('#ani');
  var $aniCount1 = $('#ani_count_1');
  var $aniCount2 = $('#ani_count_2');
  var $aniInfo1 = $('#ani_info_1');
  var $aniInfo2 = $('#ani_info_2');

  function chainTest() {
    // 默认队列。
    $ani.animate({
      left: 600,
      top: 30
    }, {
      duration: 500,
      transition: 'easeInOut',
      onBeforeStart: function() {
      },
      onStart: function() {
        $aniCount1.innerText = this.getAnimationQueue().length;
        $aniInfo1.innerText = '1';
      },
      onFinish: function() {
        $aniInfo1.innerText = '=1=';
      }
    })
        .animate(null, {
          duration: 500,
          transition: 'easeOutIn',
          onStart: function() {
            $aniCount1.innerText = this.getAnimationQueue().length;
            $aniInfo1.innerText = 'WAIT';
          },
          onFinish: function() {
            $aniInfo1.innerText = '=WAIT=';
          }
        })
        .animate({
          left: 400,
          top: 100
        }, {
          duration: 500,
          transition: 'cubicBezier(.4,-0.35,.4,1)',
          onStart: function() {
            $aniCount1.innerText = this.getAnimationQueue().length;
            $aniInfo1.innerText = '2';
          },
          onFinish: function() {
            $aniInfo1.innerText = '=OVER=';
          }
        })
      // 新队列。
        .animate({
          width: 350,
          height: 80,
          fontSize: 25,
          lineHeight: '40px',
          color: '#ffffff',
          backgroundColor: '#dc143c',
          opacity: .3
        }, {
          duration: 600,
          transition: 'linear',
          onStart: function() {
            $aniCount2.innerText = this.getAnimationQueue('2').length;
            $aniInfo2.innerText = '1';
          },
          onFinish: function() {
            $aniInfo2.innerText = '=1= layer run';
            $('#layer').animate({
              left: 400,
              top: 100,
              width: 200,
              height: 150,
              backgroundColor: '#adff2f',
              lineHeight: '150px',
              opacity: .5
            }, {
              duration: 500,
              transition: 'cubicBezier(.6,0,.6,1.35)',
              onStart: function() {
//              this.innerText = 'GO';
              },
              onFinish: function() {
//              this.innerText = '';
              }
            });
          },
          queueName: '2'
        })
        .animate(null, {
          duration: 500,
          onStart: function() {
            $aniCount2.innerText = this.getAnimationQueue('2').length;
            $aniInfo2.innerText = 'WAIT';
          },
          onFinish: function() {
            $aniInfo2.innerText = '=WAIT=';
          },
          queueName: '2'
        })
        .animate({
          height: 150,
          width: 200,
          fontSize: 40,
          lineHeight: '75px',
          color: '#000000',
          backgroundColor: '#ffd711',
          opacity: 1
        }, {
          duration: 300,
          transition: 'easeIn',
          onStart: function() {
            $aniCount2.innerText = this.getAnimationQueue('2').length;
            $aniInfo2.innerText = '2';
          },
          onFinish: function() {
            $aniInfo2.innerText = '=OVER=';
//          chainTest();
          },
          queueName: '2'
        });
  }

  $ani.on('mouseover', function() {
    var queue = this.getAnimationQueue('2');
    if (queue) {
      this.stopAnimate('2');
      $aniInfo2.innerText = '=STOP=';
      $aniCount2.innerText = queue.length || 0;
    }
  });
  $('#layer').on('click', function() {
    chainTest();
    return false;
  });

//--------------------------------------------------[TEST 1]
  var $highlight = $('#highlight');
  var highlight = new Animation().addClip(new Fx.Highlight($('#layer'), '#FFFF00', 2, 0, 500, 'easeIn'));
  $highlight.on('click', function() {
    highlight.stop().play();
  });
  $('#fade_in').on('click', function() {
    $layer.fadeIn({
      onBeforeStart: function() {
        return true;
      },
      onProcess: function() {
        console.log(this.getStyle('opacity'));
      }
    });
    setTimeout(function() {
      console.log(JSON.stringify($layer.getAnimationQueue()));
    }, 150);
  });
  $('#fade_out').on('click', function() {
    $layer.fadeOut(/*{onBeforeStart: function() {
     //    return false;
     }}*/);
  });

//--------------------------------------------------[TEST 2]
  var frames = 0;
  var reverse = true;
  var $layer = $('#layer').setStyle('opacity', 0.75);

//-------------------------[animation]
  window.animation = new Animation()
      .addClip(new Fx.Fade($layer, 'in', 0, 1000, 'linear'))
//      .addClip(new Fx.Highlight($layer, '#FFFF00', 1, 0, 1000, 'easeIn'))
//      .addClip(
//      new Fx.Morph($layer, {
//        backgroundColor: '#FFD700'
//      }, 300, 500))
      .addClip(
      new Fx.Morph($layer, {
        width: 500
      }, 300, 400, 'cubicBezier(.6,0,.6,1.35)'))
      .addClip(
      new Fx.Base(function(x, y) {
        $layer.toggleClass('highlight');
      }, 700, 0, 'linear'))
      .addClip(
      new Fx.Morph($layer, {
        left: 475,
        top: 100,
        height: 300,
        color: '#C00000',
        fontSize: 30,
        lineHeight: 300
      }, 0, 1000, 'cubicBezier(.25,1.25,.75,-0.25)'))
      .on(
      'play', function() {
        frames = 0;
        $layer.empty().innerHTML = 'Moving...';
        console.log('PLAY');
      })
      .on(
      'reverse', function() {
        console.log('REVERSE');
      })
      .on(
      'step', function() {
        frames++;
//        console.log('STEP');
      })
      .on(
      'playfinish', function() {
        $layer.empty().append($('<span>Done! FPS: ' + frames + '</span>'));
//        $layer.empty().append($('<span>Done! FPS: ' + frames + '</span>').animate(null, {duration: 1000}).fadeOut({onEnd: function() {
//          this.remove();
//        }}));
        console.log('PLAYFINISH');
//        reverse ? animation.reverse() : animation.play();
//        reverse = !reverse;
      })
      .on(
      'reversefinish', function() {
        console.log('REVERSEFINISH');
      })
      .on(
      'pause', function() {
        console.log('PAUSE');
      })
      .on(
      'stop', function() {
        console.log('STOP');
      });

//-------------------------[controls]
  document.on('keydown', function(e) {
    switch (e.which) {
      case 37:
        animation.reverse();
        return false;
      case 38:
        animation.stop();
        return false;
      case 39:
        animation.play();
        return false;
      case 40:
        animation.pause();
        return false;
    }
  });
  $('#play2').on('click', function() {
    animation.play();
  });
  $('#reverse2').on('click', function() {
    animation.reverse();
  });
  $('#pause2').on('click', function() {
    animation.pause();
  });
  $('#stop2').on('click', function() {
    animation.stop();
  });

//--------------------------------------------------[TEST 3]
  var $canvas = $('#canvas');
  $('#test3').on('click', function(e) {
    var color = this.getStyle('backgroundColor');
    new Animation()
        .addClip(
        new Fx.Base(function(x, y) {
          x = Math.floor(x * 299);
          y = Math.floor(y * 299);
          $canvas.appendChild($('<div style="left: ' + x + 'px; bottom: ' + y + 'px; background-color: ' + color + '"></div>'));
        }, 0, 2500, this.innerText))
        .play();
  }, function() {
    return this.nodeName === 'BUTTON';
  });
  $canvas.on('click', function(e) {
    if (e.shiftKey) {
      $('#test3').find('button').forEach(function($button, index) {
        setTimeout(function() {
          $button.fire('click');
        }, index * 100);
      });
      return false;
    }
    if (e.ctrlKey) {
      $('#test3').find('button').forEach(function($button) {
        $button.fire('click');
      });
      return false;
    }
    this.empty();
    return false;
  });
});
</script>
</body>
</html>
