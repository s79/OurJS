<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Validator</title>
<link rel="stylesheet" href="../stylesheets/framework.css">
<script src="../dev.js"></script>
<script src="../src/components/validator.js"></script>
<style>
table { table-layout: fixed; width: 600px; }
col.key { width: 100px; }
col.value { width: 220px; }
th { text-align: right; }
th.submit { text-align: center; }
textarea { resize: none; }
p { float: left; margin: 0; padding: 3px 10px; border-radius: 2px; font-size: 12px; line-height: 1; }
p.validating,
p.hint { border: 1px solid #BCE8F1; background: #D9EDF7; color: #3A87AD; }
p.valid { border: 1px solid #D6E9C6; background: #DFF0D8; color: #468847; }
p.invalid { border: 1px solid #EED3D7; background: #F2DEDE; color: #B94A48; }
td p { display: none; }
td.hint p.hint,
td.valid p.valid,
td.validating p.validating,
td.invalid p.invalid { display: block; }
td.hint p.valid,
td.hint p.validating,
td.hint p.invalid,
td.validating p.valid,
td.validating p.invalid { display: none; }
</style>
</head>
<body>
<div id="content">
  <h1>Validator</h1>
  <fieldset>
    <legend>表单验证</legend>
    <form id="form" method="get" action="http://www.lianzhong.com/">
      <table>
        <colgroup>
          <col class="key">
          <col class="value">
          <col class="message">
        </colgroup>
        <tbody>
          <tr>
            <th>姓名：</th>
            <td><input name="name" type="text" value=""></td>
            <td id="msg_name">
              <p class="hint">请输入姓名</p>
              <p class="validating">验证中……</p>
              <p class="valid">√ 可以使用</p>
              <p class="invalid">输入 ourjs 即可通过验证</p>
            </td>
          </tr>
          <tr>
            <th>信箱：</th>
            <td><input name="email" type="text"></td>
            <td id="msg_email">
              <p class="hint"></p>
              <p class="valid">√</p>
              <p class="invalid"></p>
            </td>
          </tr>
          <tr>
            <th>年龄：</th>
            <td><input name="age" type="text" value="28"></td>
            <td id="msg_age">
              <p class="hint">请输入年龄</p>
              <p class="valid">√</p>
              <p class="invalid">年龄应在 18 - 80 之间</p>
            </td>
          </tr>
          <tr>
            <th>密码：</th>
            <td><input name="password" type="password"></td>
            <td id="msg_password">
              <p class="hint">请输入密码</p>
              <p class="valid">√</p>
              <p class="invalid">必须输入密码</p>
            </td>
          </tr>
          <tr>
            <th>重复密码：</th>
            <td><input name="password_confirm" type="password"></td>
            <td id="msg_password_confirm">
              <p class="hint">请重复输入密码以确保您刚才没有输错</p>
              <p class="valid">√</p>
              <p class="invalid">两次输入的密码不一致</p>
            </td>
          </tr>
          <tr>
            <th>操作系统：</th>
            <td>
              <select name="os">
                <option value="" selected>请选择</option>
                <option value="Win98">Win98</option>
                <option value="WinXP">WinXP</option>
                <option value="Win7">Win7</option>
                <option value="MacOS">MacOS</option>
              </select>
            </td>
            <td id="msg_os">
              <p class="valid">√</p>
              <p class="invalid">此为必选项</p>
            </td>
          </tr>
          <tr>
            <th>玩过的游戏：</th>
            <td>
              <select name="games" size="6" multiple>
                <option value="pal">仙剑奇侠传</option>
                <option value="sc" selected>星际争霸</option>
                <option value="wow" selected disabled>魔兽世界</option>
                <optgroup label="id Software" disabled>
                  <option value="doom" selected>毁灭战士</option>
                  <option value="quake" selected>雷神之锤</option>
                </optgroup>
              </select>
            </td>
            <td id="msg_games">
              <p class="valid">√</p>
            </td>
          </tr>
          <tr>
            <th>语言能力：</th>
            <td>
              <input name="language" value="汉语" type="checkbox">汉语
              <input name="language" value="英语" type="checkbox">英语
              <input name="language" value="法语" type="checkbox">法语
              <input name="language" value="日语" type="checkbox">日语
            </td>
            <td id="msg_language">
              <p class="valid">√</p>
              <p class="invalid">请选择 2 - 3 项</p>
            </td>
          </tr>
          <tr>
            <th>所在省份：</th>
            <td>
              <input name="from" value="广东" type="radio" checked disabled>广东
              <input name="from" value="湖南" type="radio">湖南
              <input name="from" value="浙江" type="radio">浙江
              <input name="from" value="江苏" type="radio">江苏<br>
              <input name="from" value="黑龙江" type="checkbox" checked disabled>黑龙江
              <input name="from" value="吉林" type="checkbox">吉林
              <input name="from" value="辽宁" type="checkbox">辽宁<br>
              <select name="from">
                <option value="">这里也能选</option>
                <option value="河北">河北</option>
                <option value="甘肃">甘肃</option>
                <option value="陕西">陕西</option>
              </select>
              <input name="from" type="text" value="">
            </td>
            <td id="msg_from">
              <p class="hint">多类型混合的表单域</p>
              <p class="valid">√</p>
              <p class="invalid">必选项（若已选定的控件被禁用则视为无效）</p>
            </td>
          </tr>
          <tr>
            <th>自我介绍：</th>
            <td><textarea name="description" rows="5" cols="25">普通玩家</textarea></td>
            <td id="msg_description">
              <p class="hint">请输入自我介绍</p>
              <p class="valid">√</p>
              <p class="invalid">自我介绍应限制在 10 - 200 字</p>
            </td>
          </tr>
          <tr>
            <th colspan="3" class="submit">
              <button type="reset">复位事件被阻止</button>
              <button type="submit">确定提交</button>
            </th>
          </tr>
        </tbody>
      </table>
    </form>
  </fieldset>
  <script>
  execute(function($) {
    var textControls = ['text', 'password', 'textarea'];
    var $form = $('#form')
        .on('focusin, focusout', function(e) {
          var $target = e.target;
          var name = $target.name;
          var controlType = name ? $target.type : undefined;
          if (textControls.contains(controlType)) {
            $('#msg_' + name)[e.type === 'focusin' ? 'addClass' : 'removeClass']('hint');
          }
        })
        .on('reset', function() {
          return false;
        })
        .on('submit', function() {
          v.validate();
          return false;
        });

//    console.log($form.getFieldValue('age'));
//    console.log($form.getFieldValue('os'));
//    console.log($form.getFieldValue('games'));
//    console.log($form.getFieldValue('language'));
//    console.log($form.getFieldValue('from'));
//    console.log($form.getFieldValue('description'));

    window.v = new Validator($form, {
      name: {
        required: true,
        serverSideVerify: {
          url: 'validator.asp',
          options: {
            useCache: false,
            requestParser: function(data) {
              return 'value=' + data;
            },
            responseParser: function(data) {
              return {result: data.text === 'true'};
            }
          }
        }
      },
      age: {
        handler: function(value) {
          return value === '' || parseInt(value, 10) + '' === value && value >= 18 && value <= 80;
        }
      },
      password: {
        triggerEventType: 'input',
        required: true
      },
      'password_confirm': {
        triggerEventType: 'input',
        equals: 'password'
      },
      os: {
        required: true
      },
      games: {
      },
      language: {
        minLength: 2,
        maxLength: 3
      },
      from: {
        required: true
      },
      description: {
        minLength: 10,
        maxLength: 200
      }
    })
        .on('fieldvalidationstart', function(e) {
          console.log('fieldvalidationstart', e.name, e.value);
          $('#msg_' + e.name).addClass('validating');
        })
        .
        on('fieldvalidationfinish', function(e) {
          console.log('fieldvalidationfinish', e.name, e.value, e.result);
          $('#msg_' + e.name).removeClass('validating').removeClass('valid').removeClass('invalid').addClass(e.result ? (e.value.length > 0 ? 'valid' : '') : 'invalid');
        });
  });
  </script>
</div>
</body>
</html>
