<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>beforeunload</title>
<script src="../dev.js"></script>
</head>
<body>
<label for="switcher"><input id="switcher" type="checkbox">为 window 添加 beforeunload 事件监听器</label>
<a href="javascript:void('nothing');">点击伪协议的超链接在 IE6 IE7 IE8 IE9 中也会触发 beforeunload 事件</a>
<script>
(function() {
  var showMessage = true;
  $('#switcher')
      .on('change', function() {
        if (this.checked) {
          window.on('beforeunload', function(e) {
            console.log('this = ' + typeOf(this));
            console.log('e = ' + e);
            if (showMessage) {
              var message = '离开此页面将导致未保存的数据丢失！';
              if (navigator.isFirefox) {
                alert(message + '\n如果要留在此页面，请在稍后的对话框中点击“留在页面”按钮。\n如果确定要离开，请在稍后的对话框中点击“离开页面”按钮。');
              }
              return message;
            }
          });
        } else {
          window.off('beforeunload');
        }
      })
      .checked = false;
  // 点击伪协议的超链接在 IE6 IE7 IE8 IE9 中也会触发 beforeunload 事件。
  // 具体是在 IE6 IE7 IE8 的 document 和 IE9 的 window 收到具备默认行为的事件时触发。
  document.on('click', function(e) {
//    e.preventDefault();
  });
})();
</script>
</body>
</html>
